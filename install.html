<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; correctionlib  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Correctionlib tutorial" href="correctionlib_tutorial.html" />
    <link rel="prev" title="correctionlib" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            correctionlib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#inside-cmssw">Inside CMSSW</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outside-cmssw">Outside CMSSW</a></li>
<li class="toctree-l2"><a class="reference internal" href="#with-python-2-outside-cmssw">With python 2 (outside CMSSW)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-from-python-and-c">Usage from python and C++</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="correctionlib_tutorial.html">Correctionlib tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="highlevel.html">correctionlib.highlevel</a></li>
<li class="toctree-l1"><a class="reference internal" href="schemav1.html">Schema v1</a></li>
<li class="toctree-l1"><a class="reference internal" href="schemav2.html">Schema v2</a></li>
<li class="toctree-l1"><a class="reference internal" href="convert.html">correctionlib.convert</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">correctionlib._core</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">correctionlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h1>
<p>This package provides both a C++ evaluator with python bindings and
a set of python tools to convert, validate, and inspect files with corrections
It is installed as a python package (see e.g.
<a class="reference external" href="https://packaging.python.org/tutorials/installing-packages/">this tutorial</a>
for an introduction), using <a class="reference external" href="https://scikit-build.readthedocs.io/">scikit-build</a>
and thus <a class="reference external" href="https://cmake.org/">CMake</a>, for the C++ components.
Builds have been tested in Windows, OS X, and Linux, and the python bindings
can be compiled against both python2 (with limited functionality) and python3,
as well as from within a CMSSW environment.
Note that CMSSW <code class="docutils literal notranslate"><span class="pre">11_2_X</span></code> and above has ROOT accessible from python 3.</p>
<section id="inside-cmssw">
<h2>Inside CMSSW<a class="headerlink" href="#inside-cmssw" title="Link to this heading"></a></h2>
<p>For CMSSW releases from the <code class="docutils literal notranslate"><span class="pre">11_3_X</span></code> branch on, correctionlib is included
as the <code class="docutils literal notranslate"><span class="pre">py3-correctionlib</span></code> tool, and from the <code class="docutils literal notranslate"><span class="pre">12_1_X</span></code> branch version 2.0,
which has the schema version 2.0 that is used by most of the corrections.
If the tool included in CMSSW supports the version you want to use,
no additional installation is needed.
The package version can also be found with the command-line tool:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>correction<span class="w"> </span>config<span class="w"> </span>--version
</pre></div>
</div>
<p>In CMSSW <code class="docutils literal notranslate"><span class="pre">10_6_30</span></code>, there is a dedicated backport of correctionlib, however
it is only the python 2 version and hence only provides the <code class="docutils literal notranslate"><span class="pre">correctionlib._core</span></code>
bindings.</p>
<p>For older release cycles the package can be installed in the user area with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>--no-binary<span class="o">=</span>correctionlib<span class="w"> </span>correctionlib
</pre></div>
</div>
<p>for python3.
Alternatively, <a class="reference external" href="https://gist.github.com/pieterdavid/8f43f302e9f8a71f92702101600b7ddb">this script</a>,
can be used to install a <code class="docutils literal notranslate"><span class="pre">py3-correctionlib</span></code> tool similar to the one provided in more recent releases,
or a <code class="docutils literal notranslate"><span class="pre">py2-correctionlib</span></code> tool with limited functionality.</p>
<p>The package can be built as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>git@github.com:cms-nanoAOD/correctionlib.git
<span class="nb">cd</span><span class="w"> </span>correctionlib
make<span class="w"> </span><span class="nv">PYTHON</span><span class="o">=</span>python
make<span class="w"> </span>install<span class="w">  </span><span class="c1"># set PREFIX=... to change from default (./correctionlib)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">python</span></code> is the name of the python scram tool you intend to link against.
This will output a <code class="docutils literal notranslate"><span class="pre">correctionlib</span></code> directory that acts as a python package, and can be moved where needed.</p>
</section>
<section id="outside-cmssw">
<h2>Outside CMSSW<a class="headerlink" href="#outside-cmssw" title="Link to this heading"></a></h2>
<p>To install in an environment that has python 3, you can simply</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>correctionlib
</pre></div>
</div>
<p>(possibly with <code class="docutils literal notranslate"><span class="pre">--user</span></code>, or in a virtualenv, etc.)</p>
<div class="admonition-wheels-or-installing-from-source admonition">
<p class="admonition-title">Wheels or installing from source?</p>
<p>The above command will try to use python wheels, prebuilt binary packages,
since it is faster and more efficient.
When using the C++ evaluator, e.g. from ROOT or a standalone executable,
the C++ ABI needs to be compatible, otherwise you will get linker errors such
as <code class="docutils literal notranslate"><span class="pre">undefined</span> <span class="pre">symbol:</span> <span class="pre">_ZN10correction13CorrectionSet9from_file...</span></code>.
To avoid this pass the <code class="docutils literal notranslate"><span class="pre">--no-binary=correctionlib</span></code> option to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>,
which will start from the source package and build the C++ components in your environment.</p>
</div>
<p>If you wish to install the latest development version, this should work:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/cms-nanoAOD/correctionlib.git
</pre></div>
</div>
</section>
<section id="with-python-2-outside-cmssw">
<h2>With python 2 (outside CMSSW)<a class="headerlink" href="#with-python-2-outside-cmssw" title="Link to this heading"></a></h2>
<p>To compile with python2 support, consider using python 3 :).
If you considered that and still want to use python2, the following recipe may work
to install only the <code class="docutils literal notranslate"><span class="pre">correctionlib._core</span></code> evaluator,
which allows to use the C++ evaluator from python2 and python3
(the schema tools and high-level bindings are python3-only):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>git@github.com:cms-nanoAOD/correctionlib.git
<span class="nb">cd</span><span class="w"> </span>correctionlib
make<span class="w"> </span><span class="nv">PYTHON</span><span class="o">=</span>python2
make<span class="w"> </span>install<span class="w">  </span><span class="c1"># set PREFIX=... to change from default (./correctionlib)</span>
</pre></div>
</div>
<p>This will output a <code class="docutils literal notranslate"><span class="pre">correctionlib</span></code> directory that acts as a python package, and can be moved where needed.</p>
</section>
<section id="usage-from-python-and-c">
<h2>Usage from python and C++<a class="headerlink" href="#usage-from-python-and-c" title="Link to this heading"></a></h2>
<p>After the installation following one of the recipes above,
the correctionlib python package should be available,
as well as the <code class="docutils literal notranslate"><span class="pre">correction</span></code> command-line utility.
In case the latter is not on your path for some reason, it can also be invoked via
<code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">correctionlib.cli</span></code>.</p>
<p>The C++ evaluator library is distributed as part of the python package, and it can be
linked to directly without using python. If you are using CMake you can depend on it by including
the output of <code class="docutils literal notranslate"><span class="pre">correction</span> <span class="pre">config</span> <span class="pre">--cmake</span></code> in your cmake invocation. A complete cmake
example that builds a user C++ application against correctionlib and ROOT RDataFrame
can be <a class="reference external" href="https://gist.github.com/pieterdavid/a560e65658386d70a1720cb5afe4d3e9">found here</a>.</p>
<p>For manual compilation, include and linking definitions can similarly be found via <code class="docutils literal notranslate"><span class="pre">correction</span> <span class="pre">config</span> <span class="pre">--cflags</span> <span class="pre">--ldflags</span></code>.
For example, the demo application can be compiled with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/cms-nanoAOD/correctionlib/master/src/demo.cc
g++<span class="w"> </span><span class="k">$(</span>correction<span class="w"> </span>config<span class="w"> </span>--cflags<span class="w"> </span>--ldflags<span class="w"> </span>--rpath<span class="k">)</span><span class="w"> </span>demo.cc<span class="w"> </span>-o<span class="w"> </span>demo
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="correctionlib" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="correctionlib_tutorial.html" class="btn btn-neutral float-right" title="Correctionlib tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, nsmith-.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>